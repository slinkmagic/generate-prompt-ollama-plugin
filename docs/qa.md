# 要件Q&A - Stable Diffusion WebUI Ollama Plugin

設計・実装前に詳細化が必要な要件項目の質問リストです。

## 1. Ollama API仕様

### Q1-1: 使用するOllamaモデル
- どのモデルを想定していますか？（llama2, codellama, mistral, gemma等）
  - openhermes
- 複数モデル対応は必要ですか？
  - 不要
- モデルサイズの制限はありますか？
  - ない

### Q1-2: APIエンドポイントと通信方式
- `/api/generate`以外に必要なエンドポイントはありますか？
  - 不明、必要に応じて変更してください
- レスポンス形式はstreamingとone-shotどちらを想定？
  - one-shot
- タイムアウト設定の要件は？（推奨: 30秒）
  - 30秒で問題ない

### Q1-3: Ollamaサーバー環境
- ローカル環境（localhost:11434）のみ？
  - ローカルのみで問題ない  
- リモートサーバー対応は必要？
  - 不要
- 認証機能は必要？
  - 不要

## 2. プロンプト拡張の詳細

### Q2-1: 拡張ルール
- どのような情報を追加したいですか？
  - シーンや背景（例: "forest", "cityscape"等）
  - 色調やムード（例: "dark", "vibrant"等）
  - 構図やカメラアングル（例: "wide shot", "close-up"等）
  - ライティングや照明（例: "dramatic lighting", "soft light"等）
  - テーマやコンセプト（例: "fantasy", "sci-fi"等）
  - 構図やカメラアングル（例: "wide shot", "close-up"等）
- どのような情報を除外したいですか？
  - アーティスト名やスタイル（例: "by Van Gogh", "in the style of Studio Ghibli"等）
  - 技術や手法（例: "digital art", "watercolor"等）
  - スタイル情報（アート風、写実的等）
- プロンプトテンプレートは固定？カスタマイズ可能？
  - 固定テンプレートを使用

### Q2-2: 元プロンプトとの結合方法
- 拡張プロンプト(Ollamaで取得したプロンプト)を前後どちらに追加？
  - 後ろに追加
- 元プロンプトの一部置換は必要？
  - 置換は不要
- プロンプト間の区切り文字は？（カンマ、改行等）
  - カンマで区切る

### Q2-3: バリエーション戦略
- バッチ間でどのように差別化しますか？
  - ランダム要素の追加
- 再現性は必要？（同じ入力で同じ結果）
  - 再現性は不要

### Q2-4: プロンプト制限
- 最大文字数制限は？
  - 150tokenを目途
- ネガティブプロンプトの扱いは？
  - ネガティブプロンプトは使用しない
- 禁止ワード/フィルタリングは必要？
  - 特に禁止ワードはなし

## 3. SDWUI統合の技術詳細

### Q3-1: フックポイント
- Generateボタンのどの時点で割り込みますか？
  - Batch Count単位で変わる場所
- txt2img/img2img両方対応？ 
  - txt2imgのみ対応

### Q3-2: バッチ処理の実装
- SDWUIの内部APIを使用？
  - はい、内部APIを使用
- バッチカウントの取得方法は？
  - SDWUIの設定から取得
- バッチごとに異なるプロンプトを設定する方法は？
  - Ollama APIから取得したプロンプトをバッチごとに適用

### Q3-3: エラーハンドリング
- Ollama接続失敗時の動作は？
  - エラーメッセージ表示
  - 処理中断
- 部分的失敗（一部バッチのみ失敗）の扱いは？
  - エラーが発生したバッチのみスキップし、他のバッチは続行
  - 連続5回失敗した場合は処理を中断し、ユーザーに通知

### Q3-4: UI/UX
- 処理中の表示は必要？
  - プログレスバー
  - ステータステキスト
- 拡張結果のプレビュー表示は？
  - プレビューは不要

## 4. 設定・管理機能

### Q4-1: 設定項目
必要な設定項目を教えてください：
- OllamaサーバーURL
- 使用モデル名
- プロンプトテンプレート
- タイムアウト時間
- 有効/無効切り替え

### Q4-2: 設定保存
- 設定保存場所は？
  - 独立したJSONファイル
- 設定の共有・エクスポート機能は必要？
  - 設定の共有・エクスポート機能は不要

### Q4-3: デフォルト設定
- 初回起動時のデフォルト値は？
  - OllamaサーバーURL: `http://localhost:11434`
  - 使用モデル名: `openhermes`
  - プロンプトテンプレート: 固定テンプレート
  - タイムアウト時間: 30秒
- サンプルプロンプトテンプレートは提供？
  - 必要

### Q4-4: 設定変更の反映
- 設定変更時の再起動は必要？
  - 再起動は必要
- リアルタイム反映は必要？
  - リアルタイム反映は不要

## 5. パフォーマンス要件

### Q5-1: 応答時間
- Ollama API呼び出しの許容時間は？
  - 30秒以内
- ユーザー体験上の許容待機時間は？
  - 30秒以内

### Q5-2: 同時処理
- バッチ処理は並列実行？逐次実行？
  - 逐次実行
- 並列実行時の同時接続数制限は？
  - 同時接続数は制限なし

### Q5-3: リソース使用量
- メモリ使用量の制限は？
  - 1GB以下を目指す
- CPU使用率の制限は？
  - 50%以下を目指す
- ログ出力レベルは？
  - info・エラーログを出力

## 6. セキュリティ・運用

### Q6-1: セキュリティ
- API通信の暗号化は必要？
  - 不要
- ローカル設定ファイルの暗号化は？
  - 不要
- プロンプトのログ記録は必要？
  - プロンプトのログ記録は不要
  - console.logに出力する

### Q6-2: 運用・保守
- デバッグ機能は必要？
  - Claude Codeがわかるレベルで必要
- ログレベルの調整は？
  - Claude Codeがわかるレベルで必要
- 統計情報の収集は？
  - 統計情報の収集は不要

## 7. 将来拡張

### Q7-1: 拡張性
- 他のLLMサービス（OpenAI、Claude等）への対応予定は？
  - 現時点ではOllamaのみ対応
- プラグインシステムの構築は？
  - プラグインシステムは不要
- API公開の予定は？
  - API公開は不要

## 8. 技術実装詳細

### Q8-1: プロンプトテンプレート仕様
- 固定テンプレートの具体的な内容は？
- Ollamaに送る指示文の具体例は？
  - "以下のプロンプトを拡張してください。シーン、色調、構図、ライティング、テーマから2-3個選んで追加し、アーティスト名や技術情報は除外してください。50token以内で出力してください。"
  - Ollamaに送るときは英語にしてください
- Ollamaからの応答フォーマット指定は必要？
  - 使いやすい方法であれば特に指定は不要

### Q8-2: SDWUI技術統合詳細
- プラグインファイルの配置場所は？
  - extensions/フォルダ内
- フック実装方式は？
  - やりやすい方法であれば特に指定は不要
- バッチカウント取得の具体的な方法は？
  - どのgradio要素から取得？
  - グローバル変数？

### Q8-3: エラー処理の詳細定義
- 「連続5回失敗」の具体的な定義は？
  - API通信の5回
- エラーメッセージ表示方法は？
  - UI通知
- フォールバック動作の詳細は？
  - 元プロンプトで続行

### Q8-4: 設定ファイル詳細仕様
- JSONファイル名と配置場所は
  - ファイル名: settings.json
  - 配置場所: extensionsフォルダ内
- 設定項目のvalidation仕様は
  - URL形式チェック
  - 数値範囲チェック
- 初回起動時の動作は
  - 設定ファイル自動生成

### Q8-5: ログ出力詳細仕様
- ログ出力先は
  - console.logのみ
- ログフォーマットの要件は
  - タイムスタンプ必要
  - 構造化ログ（JSON）
- デバッグログの具体的な内容は？
  - API通信の詳細（リクエスト・レスポンス）
  - プロンプト変換の詳細
  - エラースタックトレース

---
